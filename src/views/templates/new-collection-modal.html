<div id="myModal" class="modal">
    <div class="modal-content">
        <form id="selectionForm">
            <h2>New Collection</h2>
            <div class="view-upper">
                <div class="input-group">
                    <label for="customCollection">Custom Collection</label>
                    <input type="checkbox" id="customCollection" name="customCollection">
                </div>
                <div class="input-group" id="presetGroup">
                    <label for="preset">Preset</label>
                    <select id="preset" name="preset">
                        <option value="x" disabled selected>Select preset...</option>
                        <option value="video games">video games</option>
                        <option value="perfume">perfume</option>
                        <option value="movies">movies</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="color">Color</label>
                    <input type="color" id="color" name="color">
                </div>
            </div>
            <div class="view-lower">
                <div class="input-group">
                </div>
                <div class="multi-field-wrapper">
                    <input type="text" id="collection-name" class="textbox" placeholder="Enter collection name">
                    <button type="button" class="add-field">+</button>
                    <div class="multi-fields">
                        <div class="multi-field">
                            <input type="text" name="customField[]" class="textbox" placeholder="Enter field name">
                            <button type="button" class="remove-field">-</button>
                    </div>
                </div>
            </div>

                <div class="input-group">
                    <button type="button" id="cancelBtn">Cancel</button>
                    <button type="submit" id="saveBtn">Save</button>
                </div>
            </div>
        </form>
    </div>
</div>
<script src="/js/modal-action.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        $('.multi-field-wrapper').each(function() {
            var $wrapper = $('.multi-fields', this);

            $(".add-field", $(this)).click(function() {
                $('.multi-field:first-child', $wrapper).clone(true).appendTo($wrapper).find('input').val('').focus();
            });

            $wrapper.on('click', '.remove-field', function() {
                if ($('.multi-field', $wrapper).length > 1) {
                    $(this).parent('.multi-field').remove();
                }
            });
        });

        $('#preset').on('change', async function() {
            if (!$('#customCollection').is(':checked')) {
                const selectedPreset = $(this).val();

                try {
                    const response = await fetch(
                        `https://dev.collectiqo.com:3000/get-preset-data?templateName=${selectedPreset}`,
                    );

                    if (response.ok) {
                        const templateData = await response.json();
                        console.log(`Template Data: ${templateData}`)

                        // Clear existing fields
                        $('.multi-fields').empty();

                        // Create a new field for each column entry in the template data
                        let i = 0;
                        templateData.columns.forEach((column) => {
                            i++;
                            console.log(`Create entry for column: ${column}`)
                            const newField = $('<div class="multi-field">')
                                .append(`<input type="text" name="customField[]" class="textbox" placeholder="Field ${i}" value="${column}">`)
                                .append('<button type="button" class="remove-field">-</button>');
                            $('.multi-fields').append(newField);
                        });
                    } else {
                        console.error('Failed to fetch preset data:', response.statusText);
                    }
                } catch (error) {
                    console.error('Error fetching preset data:', error);
                }
            }
        });
    });
</script>
