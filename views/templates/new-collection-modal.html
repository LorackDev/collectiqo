
<div id="myModal" class="modal">
    <div class="modal-content">
        <form id="selectionForm">
            <div class="input-group">
                <label for="preset">Preset:</label>
                <select id="preset" name="preset">
                    <option value="video games">video games</option>
                    <option value="perfume">perfume</option>
                    <option value="movies">movies</option>
                    <option value="custom">Custom</option>
                </select>
            </div>
            <div class="input-group">
                <label for="color">Color:</label>
                <input type="color" id="color" name="color">
            </div>
            <div class="input-group">
                <label for="collection">Collection Name:</label>
                <input type="text" id="collection" name="collection">
            </div>
            <div class="custom-options">
                <div class="input-group">
                    <label for="custom1">Custom 1:</label>
                    <input type="text" id="custom1" name="custom1" disabled>
                </div>
            </div>
            <div class="input-group">
                <button type="button" id="addCustomField">+</button>
            </div>
            <div class="input-group">
                <button type="button" id="cancelBtn" onclick="closeModal()">Cancel</button>
                <button type="submit" id="saveBtn">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Get the modal
    var modal = document.getElementById("myModal");

    // Get the button that opens the modal
    var btn = document.getElementsByTagName("button")[0];

    // When the user clicks the button, open the modal
    function openModal() {
        modal.style.display = "block";
    }

    // When the user clicks on the button (Cancel), close the modal
    function closeModal() {
        modal.style.display = "none";
    }

    document.getElementById("preset").addEventListener("change", function () {
        var customOptions = document.getElementsByClassName("custom-options");
        for (var i = 0; i < customOptions.length; i++) {
            if (this.value === "custom") {
                customOptions[i].innerHTML = `
            <div class="input-group">
              <label for="custom1">Custom 1:</label>
              <input type="text" id="custom1" name="custom1">
            </div>
          `;
            } else {
                customOptions[i].innerHTML = "";
            }
        }
    });

    document.getElementById("addCustomField").addEventListener("click", function () {
        var customOptions = document.getElementsByClassName("custom-options")[0];
        var inputCount = customOptions.getElementsByClassName("input-group").length + 1;

        if (inputCount > 1 && inputCount <= 10) {
            var inputGroup = document.createElement('div');
            inputGroup.className = "input-group";

            var label = document.createElement('label');
            label.setAttribute("for", "custom" + inputCount);
            label.textContent = "Custom " + inputCount + ": ";

            var input = document.createElement('input');
            input.type = "text";
            input.id = "custom" + inputCount;
            input.name = "custom" + inputCount;

            var removeBtn = document.createElement('span');
            removeBtn.className = "remove-btn";
            removeBtn.textContent = "🗑️";
            removeBtn.onclick = function () {
                this.parentNode.remove();
                var customOptions = document.getElementsByClassName("custom-options")[0];
                var customInputs = customOptions.getElementsByClassName("input-group");
                for (var i = 3; i < customInputs.length; i++) {
                    customInputs[i].getElementsByTagName("label")[0].textContent = "Custom " + (i + 1) + ":";
                }
                // Re-display the "+" button
                document.getElementById("addCustomField").style.display = "inline-block";
            };

            inputGroup.appendChild(label);
            inputGroup.appendChild(input);
            inputGroup.appendChild(removeBtn);
            customOptions.appendChild(inputGroup);

            // Hide the "+" button if inputCount reached 10
            if (inputCount >= 10) {
                document.getElementById("addCustomField").style.display = "none";
            }
        }
    });

    document.getElementById('selectionForm').addEventListener('submit', async function (event) {
        event.preventDefault(); // Prevent the default form submission

        const formData = {
            templateName: document.getElementById('preset').value,
            color: document.getElementById('color').value,
            collectionName: document.getElementById('collection').value,
            customFields: []
        };

        var customOptions = document.getElementsByClassName("custom-options")[0];
        var customInputs = customOptions.getElementsByClassName("input-group");

        for (let i = 0; i < customOptions.length; i++) {
            const input = customInputs[i].querySelector('input');
            formData.customFields.push({
                name: input.name
            });
        }

        console.log(formData);

        try {
            const response = await fetch('/create-collection-from-template', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });
            if (response.ok) {
                alert('Collection saved successfully');
                closeModal();
            } else {
                const errorData = await response.json();
                alert('Failed to save collection: ' + errorData.message);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Failed to save collection');
        }
    });


</script>
